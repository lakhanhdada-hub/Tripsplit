<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>TripSplit Cloud Pro Max</title>
    <!-- Th∆∞ vi·ªán c·∫ßn thi·∫øt -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://unpkg.com/lucide@latest"></script>
    <!-- Firebase SDK -->
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.1.0/firebase-app.js";
        import { getFirestore, collection, doc, setDoc, getDoc, onSnapshot, addDoc, updateDoc, deleteDoc, query } from "https://www.gstatic.com/firebasejs/11.1.0/firebase-firestore.js";
        import { getAuth, signInAnonymously, signInWithCustomToken, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/11.1.0/firebase-auth.js";

        window.FirebaseSDK = { initializeApp, getFirestore, collection, doc, setDoc, getDoc, onSnapshot, addDoc, updateDoc, deleteDoc, query, getAuth, signInAnonymously, signInWithCustomToken, onAuthStateChanged };
    </script>

    <style>
        @import url('https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@400;600;700;800&display=swap');
        body { font-family: 'Plus Jakarta Sans', sans-serif; -webkit-tap-highlight-color: transparent; }
        .safe-top { padding-top: env(safe-area-inset-top); }
        .safe-bottom { padding-bottom: env(safe-area-inset-bottom); }
        @keyframes bounce-in {
            0% { transform: translateY(-20px); opacity: 0; }
            60% { transform: translateY(5px); opacity: 1; }
            100% { transform: translateY(0); }
        }
        .animate-bounce-in { animation: bounce-in 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275); }
        .animate-in { animation: fadeIn 0.3s ease-out; }
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
        .zoom-in { animation: zoomIn 0.2s ease-out; }
        @keyframes zoomIn { from { transform: scale(0.95); opacity: 0; } to { transform: scale(1); opacity: 1; } }
        ::-webkit-scrollbar { display: none; }
    </style>
</head>
<body class="bg-slate-50">
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useMemo, useEffect, useRef } = React;
        
        // Mock Lucide components for React integration
        const Icon = ({ name, ...props }) => {
            const ref = useRef(null);
            useEffect(() => {
                if (window.lucide) {
                    window.lucide.createIcons();
                }
            }, [name]);
            return <i data-lucide={name} {...props}></i>;
        };

        const { 
            initializeApp, getFirestore, collection, doc, setDoc, getDoc, 
            onSnapshot, addDoc, updateDoc, deleteDoc, query,
            getAuth, signInAnonymously, signInWithCustomToken, onAuthStateChanged 
        } = window.FirebaseSDK;

        // --- FIREBASE CONFIGURATION ---
        const firebaseConfig = JSON.parse(__firebase_config);
        const fbApp = initializeApp(firebaseConfig);
        const auth = getAuth(fbApp);
        const db = getFirestore(fbApp);
        const appId = typeof __app_id !== 'undefined' ? __app_id : 'tripsplit-v1';

        const App = () => {
            const [user, setUser] = useState(null);
            const [loading, setLoading] = useState(true);
            const [members, setMembers] = useState([]);
            const [expenses, setExpenses] = useState([]);
            const [contributions, setContributions] = useState([]);
            const [treasurerId, setTreasurerId] = useState(null);
            const [newMemberName, setNewMemberName] = useState('');
            const [activeTab, setActiveTab] = useState('report'); 
            const [isExpenseModalOpen, setIsExpenseModalOpen] = useState(false);
            const [isShareModalOpen, setIsShareModalOpen] = useState(false);
            const [memberToDelete, setMemberToDelete] = useState(null); 
            const [copySuccess, setCopySuccess] = useState(false);
            const [showContributionId, setShowContributionId] = useState(null);
            const [description, setDescription] = useState('');
            const [amount, setAmount] = useState('');
            const [payerId, setPayerId] = useState('fund'); 
            const [splitWith, setSplitWith] = useState([]); 
            const [isAdvance, setIsAdvance] = useState(false);
            const [editingExpenseId, setEditingExpenseId] = useState(null);
            const [reminders, setReminders] = useState([]);

            useEffect(() => {
                const initAuth = async () => {
                    try {
                        if (typeof __initial_auth_token !== 'undefined' && __initial_auth_token) {
                            await signInWithCustomToken(auth, __initial_auth_token);
                        } else {
                            await signInAnonymously(auth);
                        }
                    } catch (error) { console.error("Auth error:", error); }
                };
                initAuth();
                const unsubscribe = onAuthStateChanged(auth, (u) => {
                    setUser(u);
                    setLoading(false);
                });
                return () => unsubscribe();
            }, []);

            useEffect(() => {
                if (!user) return;
                const pathPrefix = `artifacts/${appId}/public/data`;
                const unsubMembers = onSnapshot(collection(db, `${pathPrefix}/members`), (snapshot) => {
                    setMembers(snapshot.docs.map(doc => ({ id: doc.id, ...doc.data() })));
                });
                const unsubExpenses = onSnapshot(collection(db, `${pathPrefix}/expenses`), (snapshot) => {
                    const data = snapshot.docs.map(doc => ({ id: doc.id, ...doc.data() }));
                    setExpenses(data.sort((a, b) => (b.createdAt || 0) - (a.createdAt || 0)));
                });
                const unsubContributions = onSnapshot(collection(db, `${pathPrefix}/contributions`), (snapshot) => {
                    setContributions(snapshot.docs.map(doc => ({ id: doc.id, ...doc.data() })));
                });
                const unsubSettings = onSnapshot(doc(db, `${pathPrefix}/settings`, 'global'), (doc) => {
                    if (doc.exists()) setTreasurerId(doc.data().treasurerId);
                });
                return () => { unsubMembers(); unsubExpenses(); unsubContributions(); unsubSettings(); };
            }, [user]);

            useEffect(() => {
                const checkReminders = () => {
                    const now = Date.now();
                    const TWELVE_HOURS_MS = 12 * 60 * 60 * 1000;
                    const pendingReminders = expenses.filter(e => {
                        if (!e.isAdvance || e.reminderDismissed) return false;
                        const lastCheck = e.lastReminderAt || e.createdAt;
                        return (now - lastCheck) >= TWELVE_HOURS_MS;
                    });
                    setReminders(pendingReminders);
                };
                const interval = setInterval(checkReminders, 60000);
                checkReminders();
                return () => clearInterval(interval);
            }, [expenses]);

            const handleAddMember = async () => {
                if (!newMemberName || !user) return;
                await addDoc(collection(db, `artifacts/${appId}/public/data/members`), {
                    name: newMemberName,
                    createdAt: Date.now()
                });
                setNewMemberName('');
            };

            const handleDeleteMember = async (mId) => {
                if (!user) return;
                await deleteDoc(doc(db, `artifacts/${appId}/public/data/members`, mId));
                if (treasurerId === mId) handleSetTreasurer(null);
                setMemberToDelete(null);
            };

            const handleSetTreasurer = async (tId) => {
                if (!user) return;
                await setDoc(doc(db, `artifacts/${appId}/public/data/settings`, 'global'), { treasurerId: tId });
            };

            const handleSaveExpense = async () => {
                const val = parseFloat(amount);
                if (!description || isNaN(val) || val <= 0 || splitWith.length === 0 || !user) return;
                const now = Date.now();
                const formattedDate = new Date().toLocaleString('vi-VN', { hour: '2-digit', minute: '2-digit', day: '2-digit', month: '2-digit' });
                const expenseData = {
                    description, amount: val, payerId, splitWith, isAdvance, date: formattedDate,
                    createdAt: editingExpenseId ? expenses.find(e => e.id === editingExpenseId).createdAt : now,
                    lastReminderAt: now, reminderDismissed: false
                };
                if (editingExpenseId) {
                    await updateDoc(doc(db, `artifacts/${appId}/public/data/expenses`, editingExpenseId), expenseData);
                } else {
                    await addDoc(collection(db, `artifacts/${appId}/public/data/expenses`), expenseData);
                }
                setIsExpenseModalOpen(false); setEditingExpenseId(null); setDescription(''); setAmount(''); setPayerId('fund');
            };

            const handleContribution = async () => {
                const val = parseFloat(amount);
                if (val > 0 && showContributionId && user) {
                    await addDoc(collection(db, `artifacts/${appId}/public/data/contributions`), {
                        memberId: showContributionId, amount: val,
                        date: new Date().toLocaleString('vi-VN', { hour: '2-digit', minute: '2-digit', day: '2-digit', month: '2-digit' }),
                        createdAt: Date.now()
                    });
                    setAmount(''); setShowContributionId(null);
                }
            };

            const handleReminderAction = async (expenseId, action) => {
                if (!user) return;
                const ref = doc(db, `artifacts/${appId}/public/data/expenses`, expenseId);
                if (action === 'dismiss') await updateDoc(ref, { reminderDismissed: true });
                if (action === 'snooze') await updateDoc(ref, { lastReminderAt: Date.now() });
            };

            const allContributions = useMemo(() => {
                const manual = contributions.map(c => ({ ...c, type: 'manual' }));
                const help = expenses.filter(e => e.payerId !== 'fund').map(e => ({
                    id: `help-${e.id}`, memberId: e.payerId, amount: e.amount, date: e.date,
                    description: `Chi h·ªô: ${e.description}`, type: 'help', createdAt: e.createdAt
                }));
                return [...manual, ...help].sort((a, b) => (b.createdAt || 0) - (a.createdAt || 0));
            }, [contributions, expenses]);

            const stats = useMemo(() => {
                const totalSpent = expenses.reduce((sum, exp) => sum + exp.amount, 0);
                const totalCashIn = contributions.reduce((sum, c) => sum + c.amount, 0);
                const fundSpent = expenses.filter(e => e.payerId === 'fund').reduce((sum, e) => sum + e.amount, 0);
                const currentFund = totalCashIn - fundSpent;
                const memberStats = members.map(m => {
                    const cashIn = contributions.filter(c => c.memberId === m.id).reduce((sum, c) => sum + c.amount, 0);
                    const helpOut = expenses.filter(e => e.payerId === m.id).reduce((sum, e) => sum + e.amount, 0);
                    const totalContributed = cashIn + helpOut;
                    const totalEnjoyed = expenses.reduce((sum, exp) => {
                        if (exp.splitWith && exp.splitWith.includes(m.id)) return sum + (exp.amount / exp.splitWith.length);
                        return sum;
                    }, 0);
                    return { ...m, totalContributed, totalEnjoyed, balance: totalContributed - totalEnjoyed };
                });
                return { totalSpent, currentFund, memberStats };
            }, [members, expenses, contributions]);

            const generateReportText = () => {
                let report = `üìä B√ÅO C√ÅO DU L·ªäCH (${new Date().toLocaleDateString('vi-VN')})\n`;
                report += `----------------------------------\n`;
                report += `üí∞ T·ªïng chi: ${stats.totalSpent.toLocaleString()}K\n`;
                report += `üè¶ Qu·ªπ c√≤n: ${stats.currentFund.toLocaleString()}K\n\n`;
                report += `üë§ CHI TI·∫æT TH√ÄNH VI√äN:\n`;
                stats.memberStats.forEach(m => {
                    const tag = m.id === treasurerId ? ' (Th·ªß qu·ªπ)' : '';
                    const status = m.balance >= 0 ? `D∆∞: +${m.balance.toFixed(1)}K` : `N·ª£: ${Math.abs(m.balance).toFixed(1)}K`;
                    report += `- ${m.name}${tag}:\n  + ƒê√≥ng/H·ªô: ${m.totalContributed.toLocaleString()}K\n  + ƒê√£ d√πng: ${m.totalEnjoyed.toFixed(1)}K\n  => ${status}\n`;
                });
                report += `\nüìù NH·∫¨T K√ù CHI TI√äU:\n`;
                expenses.slice(0, 10).forEach((e, idx) => {
                    const p = e.payerId === 'fund' ? 'Qu·ªπ' : members.find(m => m.id === e.payerId)?.name || 'N/A';
                    report += `${idx + 1}. [${e.date}] ${e.isAdvance ? '[T·∫°m ·ª©ng] ' : ''}${e.description}: ${e.amount}K (${p})\n`;
                });
                return report + `\n----------------------------------\nXu·∫•t t·ª´ TripSplit Cloud App`;
            };

            if (loading) return (
                <div className="min-h-screen bg-slate-50 flex flex-col items-center justify-center space-y-4">
                    <div className="w-12 h-12 border-4 border-indigo-600 border-t-transparent rounded-full animate-spin"></div>
                    <p className="text-xs font-black uppercase tracking-widest text-indigo-600">ƒêang ƒë·ªìng b·ªô ƒë√°m m√¢y...</p>
                </div>
            );

            return (
                <div className="min-h-screen pb-32 overflow-x-hidden font-sans bg-slate-50">
                    <div className="fixed top-4 left-4 right-4 z-[100] space-y-3 max-w-md mx-auto pointer-events-none">
                        {reminders.map(r => (
                            <div key={r.id} className="bg-slate-900 text-white p-5 rounded-[2rem] shadow-2xl border border-white/10 pointer-events-auto animate-bounce-in">
                                <div className="flex gap-4">
                                    <div className="p-3 bg-amber-500 rounded-2xl shrink-0"><Icon name="bell" className="w-5 h-5 text-slate-900" /></div>
                                    <div>
                                        <p className="text-[10px] font-black text-amber-500 uppercase">Ch∆∞a x·ª≠ l√Ω t·∫°m ·ª©ng</p>
                                        <p className="text-xs font-bold mt-1">"{r.description}" ({r.amount}K) qu√° 12h.</p>
                                    </div>
                                </div>
                                <div className="flex gap-2 mt-4">
                                    <button onClick={() => handleReminderAction(r.id, 'snooze')} className="flex-1 py-3 bg-white/10 rounded-xl text-[10px] font-black uppercase">Nh·∫Øc l·∫°i</button>
                                    <button onClick={() => handleReminderAction(r.id, 'dismiss')} className="flex-1 py-3 bg-indigo-600 rounded-xl text-[10px] font-black uppercase">ƒê√£ xong</button>
                                </div>
                            </div>
                        ))}
                    </div>

                    <header className={`p-6 pb-12 rounded-b-[3rem] shadow-xl sticky top-0 z-40 transition-colors duration-500 ${stats.currentFund < 0 ? 'bg-rose-600' : 'bg-indigo-600'} text-white`}>
                        <div className="max-w-md mx-auto">
                            <div className="flex justify-between items-center mb-6">
                                <h1 className="text-xl font-black flex items-center gap-2 tracking-tighter uppercase">
                                    <Icon name="wallet" /> TRIPSPLIT
                                </h1>
                                <div className="flex items-center gap-2 bg-white/10 px-3 py-1 rounded-full text-[10px] font-black">
                                    <Icon name="refresh-cw" className="w-3 h-3 animate-spin" /> LIVE
                                </div>
                            </div>
                            <div className="flex justify-between items-center bg-white/10 backdrop-blur-md rounded-[2rem] p-4 border border-white/20">
                                <div className="text-center flex-1">
                                    <p className="text-[9px] font-bold opacity-70 uppercase">Qu·ªπ hi·ªán t·∫°i</p>
                                    <p className="text-xl font-black">{stats.currentFund.toLocaleString()}K</p>
                                </div>
                                <button onClick={() => { if (members.length > 0) { setSplitWith(members.map(m => m.id)); setIsExpenseModalOpen(true); } }}
                                    className="w-14 h-14 bg-slate-900 rounded-full flex items-center justify-center shadow-lg active:scale-90 transition-transform" disabled={members.length === 0}>
                                    <Icon name="plus" className="text-white" />
                                </button>
                                <div className="text-center flex-1">
                                    <p className="text-[9px] font-bold opacity-70 uppercase">T·ªïng ƒë√£ chi</p>
                                    <p className="text-xl font-black">{stats.totalSpent.toLocaleString()}K</p>
                                </div>
                            </div>
                        </div>
                    </header>

                    <main className="max-w-md mx-auto p-4 space-y-6">
                        {activeTab === 'report' && (
                            <div className="space-y-6 animate-in">
                                <div className="bg-white p-4 rounded-[2rem] shadow-sm flex gap-2">
                                    <input className="flex-1 px-4 py-3 bg-slate-50 rounded-xl text-sm font-bold outline-none" placeholder="Th√™m b·∫°n b√®..." value={newMemberName} onChange={e => setNewMemberName(e.target.value)} onKeyDown={e => e.key === 'Enter' && handleAddMember()}/>
                                    <button onClick={handleAddMember} className="p-3 bg-slate-900 text-white rounded-xl"><Icon name="plus" /></button>
                                </div>
                                <div className="space-y-4">
                                    <div className="flex justify-between items-center px-2">
                                        <p className="text-[10px] font-black text-slate-400 uppercase tracking-widest">Danh s√°ch th√†nh vi√™n</p>
                                        <button onClick={() => setIsShareModalOpen(true)} className="text-indigo-600 text-xs font-black flex items-center gap-1">
                                            <Icon name="share-2" className="w-3.5 h-3.5"/> XU·∫§T B√ÅO C√ÅO
                                        </button>
                                    </div>
                                    {members.map(m => {
                                        const mStats = stats.memberStats.find(s => s.id === m.id);
                                        return (
                                            <div key={m.id} className={`bg-white p-5 rounded-[2.5rem] border shadow-sm ${treasurerId === m.id ? 'border-amber-200 ring-4 ring-amber-100' : 'border-slate-100'}`}>
                                                <div className="flex justify-between items-start mb-5">
                                                    <div className="flex items-center gap-3">
                                                        <div className={`w-10 h-10 rounded-2xl flex items-center justify-center ${treasurerId === m.id ? 'bg-amber-100 text-amber-600' : 'bg-slate-100 text-slate-400'}`}>
                                                            {treasurerId === m.id ? <Icon name="crown" /> : <Icon name="user" />}
                                                        </div>
                                                        <div>
                                                            <h4 className="font-black text-lg uppercase">{m.name}</h4>
                                                            <button onClick={() => handleSetTreasurer(treasurerId === m.id ? null : m.id)} className={`text-[9px] font-bold uppercase ${treasurerId === m.id ? 'text-amber-500' : 'text-slate-300'}`}>{treasurerId === m.id ? 'ƒêang gi·ªØ qu·ªπ' : 'Ph√¢n gi·ªØ qu·ªπ'}</button>
                                                        </div>
                                                    </div>
                                                    <div className="flex gap-2">
                                                        <button onClick={() => { setAmount(''); setShowContributionId(m.id); }} className="bg-emerald-500 text-white px-3 py-2 rounded-xl text-[10px] font-black">N·ªòP QU·ª∏</button>
                                                        <button onClick={() => setMemberToDelete(m)} className="p-2 text-slate-200"><Icon name="trash-2" className="w-4 h-4"/></button>
                                                    </div>
                                                </div>
                                                <div className="grid grid-cols-3 gap-2">
                                                    <div className="bg-slate-50 p-3 rounded-2xl">
                                                        <p className="text-[8px] font-bold text-slate-400 uppercase">ƒê√≥ng/H·ªô</p>
                                                        <p className="text-sm font-black">{mStats?.totalContributed.toLocaleString()}K</p>
                                                    </div>
                                                    <div className="bg-slate-50 p-3 rounded-2xl">
                                                        <p className="text-[8px] font-bold text-slate-400 uppercase">ƒê√£ d√πng</p>
                                                        <p className="text-sm font-black">{mStats?.totalEnjoyed.toFixed(1)}K</p>
                                                    </div>
                                                    <div className={`p-3 rounded-2xl border ${mStats?.balance >= 0 ? 'bg-indigo-50 border-indigo-100' : 'bg-rose-50 border-rose-100'}`}>
                                                        <p className="text-[8px] font-bold text-slate-400 uppercase">{mStats?.balance >= 0 ? 'D∆∞ (+)' : 'N·ª£ (-)'}</p>
                                                        <p className={`text-sm font-black ${mStats?.balance >= 0 ? 'text-indigo-600' : 'text-rose-600'}`}>{mStats?.balance.toFixed(1)}K</p>
                                                    </div>
                                                </div>
                                            </div>
                                        );
                                    })}
                                </div>
                            </div>
                        )}

                        {activeTab === 'history_spent' && (
                            <div className="space-y-4 animate-in">
                                {expenses.map(e => (
                                    <div key={e.id} className="bg-white p-5 rounded-[2.5rem] border border-slate-100 flex justify-between items-center shadow-sm">
                                        <div className="flex items-center gap-4">
                                            <div className={`p-3 rounded-2xl ${e.isAdvance ? 'bg-amber-50 text-amber-600' : 'bg-indigo-50 text-indigo-600'}`}>
                                                <Icon name={e.isAdvance ? "clock" : "receipt"} className="w-5 h-5"/>
                                            </div>
                                            <div>
                                                <p className="font-black text-sm">{e.description}</p>
                                                <p className="text-[9px] font-bold text-slate-400 uppercase">{e.date} ‚Ä¢ {e.payerId === 'fund' ? 'Qu·ªπ' : members.find(m => m.id === e.payerId)?.name}</p>
                                            </div>
                                        </div>
                                        <div className="text-right">
                                            <p className="font-black text-rose-500">-{e.amount}K</p>
                                            <div className="flex gap-2 justify-end opacity-50">
                                                <button onClick={() => { setEditingExpenseId(e.id); setDescription(e.description); setAmount(e.amount.toString()); setPayerId(e.payerId); setSplitWith(e.splitWith); setIsAdvance(e.isAdvance); setIsExpenseModalOpen(true); }}><Icon name="edit-2" className="w-3.5 h-3.5 text-indigo-400"/></button>
                                                <button onClick={() => deleteDoc(doc(db, `artifacts/${appId}/public/data/expenses`, e.id))}><Icon name="trash-2" className="w-3.5 h-3.5 text-slate-300"/></button>
                                            </div>
                                        </div>
                                    </div>
                                ))}
                            </div>
                        )}

                        {activeTab === 'history_deposit' && (
                            <div className="space-y-4 animate-in">
                                {allContributions.map(c => (
                                    <div key={c.id} className="bg-white p-5 rounded-3xl border border-slate-100 flex justify-between items-center shadow-sm">
                                        <div className="flex items-center gap-4">
                                            <div className={`p-3 rounded-2xl ${c.type === 'manual' ? 'bg-emerald-50 text-emerald-600' : 'bg-amber-50 text-amber-600'}`}>
                                                <Icon name={c.type === 'manual' ? "arrow-down-left" : "user-check"} className="w-5 h-5"/>
                                            </div>
                                            <div>
                                                <p className="font-black text-sm">{members.find(m => m.id === c.memberId)?.name || 'N/A'}</p>
                                                <p className="text-[9px] font-bold text-slate-400 uppercase">{c.description || 'N·ªôp qu·ªπ'} ‚Ä¢ {c.date}</p>
                                            </div>
                                        </div>
                                        <p className={`font-black text-lg ${c.type === 'manual' ? 'text-emerald-600' : 'text-amber-600'}`}>+{c.amount}K</p>
                                    </div>
                                ))}
                            </div>
                        )}
                    </main>

                    {isExpenseModalOpen && (
                        <div className="fixed inset-0 bg-slate-900/80 backdrop-blur-sm z-50 flex items-end justify-center">
                            <div className="bg-white w-full max-w-md rounded-t-[3rem] p-8 shadow-2xl animate-in">
                                <div className="flex justify-between items-center mb-6">
                                    <h2 className="text-xl font-black italic uppercase">{editingExpenseId ? 'S·ª≠a h√≥a ƒë∆°n' : 'Ghi h√≥a ƒë∆°n'}</h2>
                                    <button onClick={() => { setIsExpenseModalOpen(false); setEditingExpenseId(null); }} className="p-2 bg-slate-100 rounded-full"><Icon name="x"/></button>
                                </div>
                                <div className="space-y-5">
                                    <input className="w-full px-6 py-4 bg-slate-50 rounded-2xl font-bold" placeholder="L√Ω do chi..." value={description} onChange={e => setDescription(e.target.value)} />
                                    <div className="grid grid-cols-2 gap-3">
                                        <input type="number" className="w-full px-6 py-4 bg-slate-50 rounded-2xl font-black text-indigo-600" placeholder="S·ªë ti·ªÅn (K)" value={amount} onChange={e => setAmount(e.target.value)} />
                                        <select className="w-full px-4 py-4 bg-slate-50 rounded-2xl font-bold text-[10px]" value={payerId} onChange={e => setPayerId(e.target.value)}>
                                            <option value="fund">üí∞ T·ª´ Qu·ªπ nh√≥m</option>
                                            {members.map(m => <option key={m.id} value={m.id}>üë§ {m.name} tr·∫£ h·ªô</option>)}
                                        </select>
                                    </div>
                                    <button onClick={() => setIsAdvance(!isAdvance)} className={`w-full flex items-center justify-between p-4 rounded-2xl border ${isAdvance ? 'bg-indigo-50 border-indigo-200' : 'bg-slate-50 border-transparent'}`}>
                                        <div className="flex items-center gap-3"><Icon name="clock" className={isAdvance ? 'text-indigo-600' : 'text-slate-400'} /><p className={`text-xs font-black ${isAdvance ? 'text-indigo-600' : 'text-slate-400'}`}>T·∫°m ·ª©ng (nh·∫Øc sau 12h)</p></div>
                                        <div className={`w-10 h-6 rounded-full p-1 ${isAdvance ? 'bg-indigo-600' : 'bg-slate-300'}`}><div className={`w-4 h-4 bg-white rounded-full transition-transform ${isAdvance ? 'translate-x-4' : 'translate-x-0'}`}/></div>
                                    </button>
                                    <div className="space-y-2">
                                        <p className="text-[9px] font-black text-slate-400 uppercase">Chia cho ai?</p>
                                        <div className="flex flex-wrap gap-2 p-3 bg-slate-50 rounded-2xl max-h-32 overflow-y-auto">
                                            {members.map(m => (
                                                <button key={m.id} onClick={() => setSplitWith(prev => prev.includes(m.id) ? prev.filter(i => i !== m.id) : [...prev, m.id])} 
                                                    className={`px-3 py-2 rounded-xl text-[10px] font-black border ${splitWith.includes(m.id) ? 'bg-indigo-600 text-white border-indigo-600' : 'bg-white text-slate-400 border-slate-100'}`}>{m.name}</button>
                                            ))}
                                        </div>
                                    </div>
                                    <button onClick={handleSaveExpense} className="w-full py-5 bg-slate-900 text-white rounded-[2rem] font-black shadow-xl uppercase tracking-widest">L∆ØU H√ìA ƒê∆†N</button>
                                </div>
                            </div>
                        </div>
                    )}

                    {showContributionId && (
                        <div className="fixed inset-0 bg-slate-900/90 backdrop-blur-md z-[110] flex items-center justify-center p-6">
                            <div className="bg-white w-full max-w-sm rounded-[3rem] p-10 shadow-2xl animate-in">
                                <h3 className="text-xl font-black mb-6 text-center uppercase">N·ªôp ti·ªÅn v√†o qu·ªπ</h3>
                                <input type="number" autoFocus className="w-full px-4 py-8 bg-slate-50 rounded-3xl font-black text-5xl text-center text-emerald-600 outline-none" placeholder="0" value={amount} onChange={e => setAmount(e.target.value)} />
                                <div className="flex gap-3 mt-8">
                                    <button onClick={() => setShowContributionId(null)} className="flex-1 py-4 font-black bg-slate-100 rounded-2xl text-[10px] uppercase">H·ªßy</button>
                                    <button onClick={handleContribution} className="flex-[2] py-4 font-black bg-emerald-500 text-white rounded-2xl text-[10px] uppercase">X√°c nh·∫≠n</button>
                                </div>
                            </div>
                        </div>
                    )}

                    {isShareModalOpen && (
                        <div className="fixed inset-0 bg-slate-900/90 backdrop-blur-md z-[80] flex items-center justify-center p-6">
                            <div className="bg-white w-full max-w-md rounded-[3rem] p-8 shadow-2xl animate-in">
                                <div className="flex justify-between items-center mb-4"><h3 className="font-black italic uppercase">B√°o c√°o</h3><button onClick={() => setIsShareModalOpen(false)} className="p-1 rounded-full bg-slate-100"><Icon name="x"/></button></div>
                                <div className="bg-slate-50 p-6 rounded-3xl mb-6 max-h-[50vh] overflow-y-auto border font-mono text-[10px] whitespace-pre-wrap">{generateReportText()}</div>
                                <button onClick={() => {
                                    const text = generateReportText();
                                    const el = document.createElement('textarea'); el.value = text; document.body.appendChild(el); el.select(); document.execCommand('copy'); document.body.removeChild(el);
                                    setCopySuccess(true); setTimeout(() => setCopySuccess(false), 2000);
                                }} className="w-full py-4 bg-indigo-600 text-white rounded-2xl font-black flex items-center justify-center gap-2">
                                    <Icon name={copySuccess ? "check" : "copy"} /> {copySuccess ? 'ƒê√É SAO CH√âP!' : 'SAO CH√âP G·ª¨I NH√ìM'}
                                </button>
                            </div>
                        </div>
                    )}

                    {memberToDelete && (
                        <div className="fixed inset-0 bg-slate-900/90 backdrop-blur-md z-[100] flex items-center justify-center p-6">
                            <div className="bg-white w-full max-w-sm rounded-[2.5rem] p-8 text-center shadow-2xl animate-in">
                                <div className="w-16 h-16 bg-rose-50 text-rose-500 rounded-full flex items-center justify-center mx-auto mb-4"><Icon name="triangle-alert" size={32}/></div>
                                <h4 className="font-black text-lg mb-2">X√≥a {memberToDelete.name}?</h4>
                                <div className="flex gap-2 mt-6">
                                    <button onClick={() => setMemberToDelete(null)} className="flex-1 py-4 bg-slate-100 font-black rounded-2xl text-[10px] uppercase">H·ªßy</button>
                                    <button onClick={() => handleDeleteMember(memberToDelete.id)} className="flex-1 py-4 bg-rose-500 text-white font-black rounded-2xl text-[10px] uppercase">X√°c nh·∫≠n</button>
                                </div>
                            </div>
                        </div>
                    )}

                    <nav className="fixed bottom-0 left-0 right-0 bg-white/80 backdrop-blur-xl border-t border-slate-100 px-6 py-4 flex justify-around items-center z-40 max-w-md mx-auto rounded-t-[3rem] shadow-lg">
                        <button onClick={() => setActiveTab('report')} className={`flex flex-col items-center gap-1 ${activeTab === 'report' ? 'text-indigo-600' : 'text-slate-300'}`}>
                            <Icon name="bar-chart-3" className="w-5 h-5" /><span className="text-[8px] font-black uppercase">Th·ªëng k√™</span>
                        </button>
                        <button onClick={() => setActiveTab('history_deposit')} className={`flex flex-col items-center gap-1 ${activeTab === 'history_deposit' ? 'text-indigo-600' : 'text-slate-300'}`}>
                            <Icon name="hand-coins" className="w-5 h-5" /><span className="text-[8px] font-black uppercase">N·ªôp qu·ªπ</span>
                        </button>
                        <button onClick={() => setActiveTab('history_spent')} className={`flex flex-col items-center gap-1 ${activeTab === 'history_spent' ? 'text-indigo-600' : 'text-slate-300'}`}>
                            <Icon name="receipt" className="w-5 h-5" /><span className="text-[8px] font-black uppercase">ƒê√£ chi</span>
                        </button>
                    </nav>
                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
